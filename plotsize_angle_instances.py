import numpy as np
import matplotlib.pyplot as plt
import matplotlib.patches as patches
import matplotlib.path as path
import utils as util
import pickle
import os
import math



angles = [-3.14032361874,-3.07750445601,-3.01468529329,-2.95186613057,-2.88904696784,-2.82622780512,-2.7634086424,-2.70058947968,-2.63777031695,-2.57495115423,-2.51213199151,-2.44931282878,-2.38649366606,-2.32367450334,-2.26085534061,-2.19803617789,-2.13521701517,-2.07239785244,-2.00957868972,-1.946759527,-1.88394036427,-1.82112120155,-1.75830203883,-1.6954828761,-1.63266371338,-1.56984455066,-1.50702538793,-1.44420622521,-1.38138706249,-1.31856789976,-1.25574873704,-1.19292957432,-1.13011041159,-1.06729124887,-1.00447208615,-0.941652923423,-0.8788337607,-0.816014597977,-0.753195435253,-0.69037627253,-0.627557109807,-0.564737947084,-0.50191878436,-0.439099621637,-0.376280458914,-0.313461296191,-0.250642133467,-0.187822970744,-0.125003808021,-0.0621846452974,0.000634517425878,0.0634536801492,0.126272842872,0.189092005596,0.251911168319,0.314730331042,0.377549493766,0.440368656489,0.503187819212,0.566006981935,0.628826144659,0.691645307382,0.754464470105,0.817283632828,0.880102795552,0.942921958275,1.005741121,1.06856028372,1.13137944644,1.19419860917,1.25701777189,1.31983693461,1.38265609734,1.44547526006,1.50829442278,1.57111358551,1.63393274823,1.69675191095,1.75957107368,1.8223902364,1.88520939912,1.94802856185,2.01084772457,2.07366688729,2.13648605002,2.19930521274,2.26212437546,2.32494353819,2.38776270091,2.45058186363,2.51340102636,2.57622018908,2.6390393518,2.70185851453,2.76467767725,2.82749683997,2.8903160027,2.95313516542,3.01595432814,3.07877349087]
anglenums = [3458.0,1703.0,1102.0,880.0,918.0,1072.0,1128.0,1375.0,1575.0,1246.0,1290.0,1383.0,1367.0,1356.0,1347.0,1346.0,1599.0,1445.0,1331.0,1502.0,1450.0,1231.0,1272.0,1938.0,3927.0,3267.0,1932.0,1163.0,1176.0,1412.0,1684.0,1708.0,1567.0,1522.0,1544.0,1490.0,1626.0,1368.0,963.0,1005.0,1081.0,1162.0,1299.0,1140.0,1327.0,1993.0,1925.0,1519.0,1624.0,3680.0,3446.0,1732.0,1048.0,1077.0,1047.0,1183.0,1317.0,1451.0,1724.0,1407.0,1212.0,1736.0,1763.0,1973.0,1856.0,2143.0,2044.0,2220.0,2247.0,2520.0,2372.0,2596.0,2257.0,2533.0,19965.0,4340.0,2597.0,1985.0,1958.0,1930.0,2145.0,2119.0,1824.0,2049.0,1978.0,1819.0,1898.0,1822.0,1286.0,1142.0,1090.0,1196.0,1176.0,906.0,1098.0,1918.0,1712.0,1073.0,1340.0,3197.0]

sizenums = [27694.0,56548.0,49580.0,15823.0,11032.0,8318.0,3691.0,2622.0,2078.0,1770.0,2013.0,1831.0,1124.0,715.0,489.0,334.0,375.0,306.0,266.0,257.0,241.0,219.0,149.0,144.0,120.0,129.0,109.0,76.0,74.0,75.0,62.0,63.0,36.0,41.0,34.0,38.0,29.0,26.0,28.0,21.0,22.0,23.0,26.0,15.0,18.0,12.0,14.0,16.0,10.0,5.0,12.0,12.0,12.0,5.0,4.0,4.0,5.0,7.0,8.0,7.0,3.0,3.0,5.0,4.0,2.0,3.0,0.0,4.0,0.0,0.0,1.0,4.0,4.0,3.0,4.0,1.0,0.0,2.0,2.0,0.0,6.0,0.0,1.0,2.0,1.0,0.0,1.0,0.0,1.0,1.0,3.0,1.0,0.0,1.0,0.0,0.0,1.0,2.0,1.0,1.0]
sizes = [3.0,20.47,37.94,55.41,72.88,90.35,107.82,125.29,142.76,160.23,177.7,195.17,212.64,230.11,247.58,265.05,282.52,299.99,317.46,334.93,352.4,369.87,387.34,404.81,422.28,439.75,457.22,474.69,492.16,509.63,527.1,544.57,562.04,579.51,596.98,614.45,631.92,649.39,666.86,684.33,701.8,719.27,736.74,754.21,771.68,789.15,806.62,824.09,841.56,859.03,876.5,893.97,911.44,928.91,946.38,963.85,981.32,998.79,1016.26,1033.73,1051.2,1068.67,1086.14,1103.61,1121.08,1138.55,1156.02,1173.49,1190.96,1208.43,1225.9,1243.37,1260.84,1278.31,1295.78,1313.25,1330.72,1348.19,1365.66,1383.13,1400.6,1418.07,1435.54,1453.01,1470.48,1487.95,1505.42,1522.89,1540.36,1557.83,1575.3,1592.77,1610.24,1627.71,1645.18,1662.65,1680.12,1697.59,1715.06,1732.53]

def getangleall():
    filelist = util.GetFileFromThisRootDir(r'E:\bod-dataset\wordlabel')
    angles = []
    for fullname in filelist:
        objects = util.parse_bod_poly(fullname)
        for obj in objects:
            poly = obj['poly']
            x2, y2 = poly[1][0], poly[1][1]
            x3, y3 = poly[2][0], poly[2][1]
            angle = math.atan2(y3 - y2, x3 - x2)
            angles.append(angle)
    return  angles

def getsizesall():
    filslist = util.GetFileFromThisRootDir(r'E:\bod-dataset\wordlabelBestStart')
    sizes = []
    for fullname in filslist:
        objects = util.parse_bod_rec(fullname)
        for obj in objects:
            w, h = obj['bndbox'][2] - obj['bndbox'][0], obj['bndbox'][3] - obj['bndbox'][1]
            size = h
            sizes.append(size)
    return sizes

def test():
    n_bins = 100
    fig, axes = plt.subplots(nrows=2, ncols=1, sharey=True)
    sizes = getsizesall()
    angles = getangleall()

    axes[0].hist(sizes, n_bins,  color='blue', label='sizes', edgecolor='white')
    axes[0].legend(prop={'size': 30})
    axes[0].set_ylabel('Instances', fontsize='xx-large')
    axes[0].set_yscale('log')
    axes[0].tick_params(direction='in',labelsize=20)

    axes[1].hist(angles, n_bins, color='blue', label='angles', edgecolor='white')
    axes[1].legend(prop={'size': 30})
    axes[1].set_ylabel('Instances', fontsize='xx-large')
    axes[1].tick_params(direction='in',labelsize=20)
#    axes[1].set_title('bars with legend')

    #fig.tight_layout()
    plt.show()
if __name__ == '__main__':
    test()